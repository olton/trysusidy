---
import {datetime} from "@olton/datetime/dist/datetime.es.js"
import {getCollection, getEntries} from "astro:content";
import Page from "./Page.astro"
import TableOfContents from "../components/TOC.astro"
import {Image} from "astro:assets"
import {slugify} from "../js/utils.js";
import PostLinks from "../components/PostLinks.astro";
import ShareThis from "../components/ShareThis.astro";
import {filterPosts, tagsWeight} from "../js/utils.js";
import RecentPosts from "../components/RecentPosts.astro";
import CloudTags from "../components/CloudTags.astro";

const { frontmatter, headings, timeToRead } = Astro.props
const { title, date, author, description, cover, draft, category, tags, time = '1 min'} = frontmatter
const relatedPosts = frontmatter.relatedPosts ? await getEntries(frontmatter.relatedPosts) : []
const recentPosts = filterPosts(await getCollection('blog'), {limit: 4})
const allPosts = filterPosts(await getCollection('blog'))
const cloudTags = tagsWeight(allPosts)
---
<Page title={title}>
    <section class="container-fluid">
        <div class="container">
            <div class="row mt-4">
                <div class="cell-md-8 border-right bd-default">
                    <div class="pr-4">
                        <h1 class="post-title text-bold">
                            <a class="history-back reduce-2" href="#"><span class="mif-arrow-left"></span></a>
                            {title}
                        </h1>
                        <div class="mb-4 text-muted reduce-1 d-flex flex-row border-top border-bottom bd-default pt-4 pb-3">
                            <span>Категорія: </span><a class="button small rounded ml-2" href=`/blog/categories/${slugify(category)}`>{category}</a>
                            <div class="ml-auto">{datetime(date).format("DD, MMM YYYY")} &bull; {timeToRead}</div>
                        </div>

                        <div class="post-content mt-4">
                            <slot/>
                        </div>
                    </div>
                </div>
                <div class="cell-md-4">
                    <div class="pl-4 pr-4">
                        <div class="mt-4">
                            <div class="text-bold enlarge-1 border-bottom bd-default">Зміст статті</div>
                            <TableOfContents headings={headings} />
                        </div>
                        <div class="mt-6">
                            <div class="text-bold border-bottom bd-default">Схожі статті</div>
                            {
                                relatedPosts.length === 0 ? <div class="reduce-1 text-muted">Нічого немає</div> : <PostLinks posts={relatedPosts}/>
                            }
                        </div>

                        <div class="blog-sidebar-group">
                            <div class="text-bold border-bottom bd-default">Хмара тегів</div>
                            <CloudTags tags={cloudTags} />
                        </div>

                        <div class="mt-6">
                            <div class="text-bold border-bottom bd-default">Поділитися</div>
                            <ShareThis/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="container-fluid mt-4 mb-10">
        <div class="container border-top bd-default pt-4 ">
            <ShareThis/>
        </div>
        <div class="container d-none">
            <RecentPosts posts={recentPosts} label="Recent posts:"/>
        </div>
    </section>
</Page>

<style is:global>
    @import "../styles/blog.css";
</style>

